<?php
/**
 * @ver 1.0
 * @order 60
 */
class ajax extends template {
  public function __construct() {
    parent::__construct();
    $this->defines('LOADED_AJAX', true);
  }

  public function call_ajax() {
    if (isset($_REQUEST['action'])) {
      $action = 'ajax_'.$_REQUEST['action'];
      if (method_exists($this, $action)) {
        call_user_func(array($this, $action), $_POST);
      } else if (method_exists($this->app, $action)) {
        call_user_func(array($this->app, $action), $_POST);
      } else {
        echo $this->format_response(false, 'Method not found.');
      }
    } else {
      echo $this->format_response(false, 'No Action set.');
    }

    exit;
  }

  public function format_response($result = false, $data = '') {
    $response = array('result' => $result);
    if ($result) {
      $response['data'] = $data;
    } else {
      $response['error'] = $data;
    }

    return json_encode($response);
  }
}
?>